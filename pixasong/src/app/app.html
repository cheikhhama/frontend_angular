<div class="app-container" [class.pixel-mode]="isPixelMode()">

  <!-- Sidebar Navigation -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <!-- Logo / Brand -->
      <div class="brand">
        <svg class="brand-icon" viewBox="0 0 24 24">
          <path
            d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 14.5c-2.49 0-4.5-2.01-4.5-4.5S9.51 7.5 12 7.5s4.5 2.01 4.5 4.5-2.01 4.5-4.5 4.5zm0-5.5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1z" />
        </svg>
        <span class="brand-text">Pixasong</span>
      </div>

      <!-- Mode Toggle -->
      <button class="nav-item" (click)="togglePixelMode()">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor">
          <path d="M4 4h4v4H4V4zm4 4h4v4H8V8zm4 4h4v4h-4v-4zm-8 4h4v4H4v-4zm16-4h-4v4h4v-4zm0-4h-4V8h4v4zm0-4h-4V4h4v4z" />
        </svg>
        <span>{{ isPixelMode() ? 'Modern Mode' : 'Pixel Mode' }}</span>
      </button>

      <!-- Search -->
      <div class="search-container">
        <input type="text" placeholder="Search" class="search-input">
        <svg class="search-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
        </svg>
      </div>

      <!-- Listening Timer -->
      <div class="listening-timer">
        <span class="timer-label">Time Listened</span>
        <span class="timer-value">{{ formattedTime() }}</span>
        <div class="streak-counter" *ngIf="streak() > 0">
          <span class="streak-icon">ðŸ”¥</span>
          <span class="streak-value">{{ streak() }}</span>
        </div>
      </div>
    </div>

    <!-- Menu Items -->
    <nav class="nav-menu scrollbar-hide">
      <button *ngFor="let item of navItems" (click)="activeTab.set(item.id)" [class.active]="activeTab() === item.id"
        class="nav-item">
        <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor">
          <path [attr.d]="item.icon"></path>
        </svg>
        <span>{{ item.name }}</span>
      </button>

      <div class="nav-section-title">My Library</div>
      <button class="nav-item"><span>Recently Added</span></button>
      <button class="nav-item"><span>Artists</span></button>
      <button class="nav-item"><span>Albums</span></button>
    </nav>
  </aside>

  <!-- Main Content Area -->
  <main class="main-content">

    <!-- Mobile Header -->
    <div class="mobile-header">
      <span class="mobile-brand">Pixasong</span>
      
      <!-- Mobile Toggle -->
      <button class="nav-item" (click)="togglePixelMode()" style="margin-right: 0.5rem; margin-left: auto; width: auto; padding: 0.5rem;">
        <span>{{ isPixelMode() ? 'Modern' : 'Pixel' }}</span>
      </button>

      <div class="mobile-timer" style="margin-right: 1rem; color: #fa233b; font-family: monospace; font-weight: 700;">
        {{ formattedTime() }}
      </div>

      <div class="user-avatar">
        <img src="https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=100&h=100&fit=crop" alt="User">
      </div>
    </div>

    <div class="content-padding">

      <!-- Hero / Goal Banner -->
      <div class="hero-card">
        <div class="hero-glow glow-1"></div>
        <div class="hero-glow glow-2"></div>

        <div class="hero-content">
          <div class="hero-text">
            <span class="hero-badge">Community Goal</span>
            <h1 class="hero-title">Help us reach <br />1000 Minutes of listening</h1>
            <p class="hero-description">Stream your favorites to unlock the exclusive "Golden Era" playlist for
              everyone.</p>

            <!-- Progress Bar -->
            <div class="hero-progress-bg">
              <div class="hero-progress-fill" [style.width.%]="goalProgressPercent()"></div>
            </div>
            <div class="hero-stats">
              <span>{{ formattedTime() }} listened</span>
              <span>{{ remainingGoalTime() }} mins left</span>
            </div>
          </div>

          <button class="btn-stream" (click)="playRandomSong()">
            <svg class="icon-play-small" viewBox="0 0 24 24">
              <path d="M8 5v14l11-7z" />
            </svg>
            Stream Now
          </button>
        </div>
      </div>

      <!-- Section: Listen Now -->
      <div class="section-header">
        <h2>Listen Now</h2>
        <button class="btn-link">See All</button>
      </div>

      <div class="songs-grid">
        <div *ngFor="let song of songs" class="song-card" (click)="playSong(song)">
          <div class="song-cover-wrapper">
            <img [src]="song.coverUrl" class="song-cover" alt="{{song.album}}">
            <!-- Play Overlay -->
            <div class="play-overlay">
              <div class="play-circle">
                <svg class="icon-play-small" viewBox="0 0 24 24">
                  <path d="M8 5v14l11-7z" />
                </svg>
              </div>
            </div>
          </div>
          <h3 class="song-title">{{ song.title }}</h3>
          <p class="song-artist">{{ song.artist }}</p>
        </div>
      </div>

      <!-- Section: New Releases (List View) -->
      <h2 class="section-title">New Releases</h2>
      <div class="songs-list">
        <div *ngFor="let song of newReleases; let i = index" class="list-item"
          [class.active-song]="currentSong().id === song.id" (click)="playSong(song)">
          <span class="list-index">{{ i + 1 }}</span>
          <span class="list-icon-active">
            <svg class="icon-play-tiny" viewBox="0 0 24 24">
              <path d="M8 5v14l11-7z" />
            </svg>
          </span>

          <img [src]="song.coverUrl" class="list-cover">

          <div class="list-info">
            <div class="list-title">{{ song.title }}</div>
            <div class="list-meta">
              <span class="badge-explicit" *ngIf="i % 2 === 0">E</span>
              {{ song.artist }}
            </div>
          </div>

          <div class="list-album">{{ song.album }}</div>
          <div class="list-duration">{{ song.duration }}</div>

          <button class="btn-more">
            <svg class="icon-dots" fill="currentColor" viewBox="0 0 24 24">
              <circle cx="12" cy="12" r="2" />
              <circle cx="19" cy="12" r="2" />
              <circle cx="5" cy="12" r="2" />
            </svg>
          </button>
        </div>
      </div>

    </div>
  </main>

  <!-- Player Bar -->
  <footer class="player-bar" *ngIf="isPlayerVisible()">

    <!-- Now Playing -->
    <div class="player-now-playing">
      <div class="np-cover-wrapper" (click)="isPlayerOpen.set(true)">
        <img [src]="currentSong().coverUrl" class="np-cover">
        <div class="np-overlay">
          <svg class="icon-expand" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />
          </svg>
        </div>
      </div>
      <div class="np-info">
        <span class="np-title">{{ currentSong().title }}</span>
        <span class="np-artist">{{ currentSong().artist }}</span>
      </div>
      <button class="btn-icon">
        <svg class="icon-heart" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z">
          </path>
        </svg>
      </button>
    </div>

    <!-- Controls -->
    <div class="player-controls">
      <div class="control-buttons">
        <button class="btn-control secondary" title="Shuffle">
          <svg class="icon-control" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path>
          </svg>
        </button>
        <button class="btn-control" (click)="previous()">
          <svg class="icon-control-main" viewBox="0 0 24 24">
            <path d="M6 6h2v12H6zm3.5 6l8.5 6V6z" />
          </svg>
        </button>
        <button class="btn-play-pause" (click)="togglePlay()">
          <svg *ngIf="!isPlaying()" class="icon-play-pause" viewBox="0 0 24 24">
            <path d="M8 5v14l11-7z" />
          </svg>
          <svg *ngIf="isPlaying()" class="icon-play-pause" viewBox="0 0 24 24">
            <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z" />
          </svg>
        </button>
        <button class="btn-control" (click)="next()">
          <svg class="icon-control-main" viewBox="0 0 24 24">
            <path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z" />
          </svg>
        </button>
        <button class="btn-control secondary" title="Repeat">
          <svg class="icon-control" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
            </path>
          </svg>
        </button>
      </div>

      <!-- Scrubber -->
      <div class="scrubber">
        <span class="time-current">{{ formattedCurrentTime() }}</span>
        <div class="scrubber-track" (click)="seek($event)">
          <div class="scrubber-fill" [style.width.%]="songProgressPercent()"></div>
          <div class="scrubber-thumb" [style.left.%]="songProgressPercent()"></div>
        </div>
        <span class="time-total">{{ currentSong().duration }}</span>
      </div>
    </div>

    <!-- Volume / Extras -->
    <div class="player-extras">
      <button class="btn-icon"><svg class="icon-volume" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3" />
        </svg></button>
      <div class="volume-slider">
        <svg class="icon-volume-small" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
        </svg>
        <div class="volume-track" (click)="setVolumeOnClick($event)">
          <div class="volume-fill" [style.width.%]="volume() * 100"></div>
          <div class="volume-thumb" [style.left.%]="volume() * 100"></div>
        </div>
      </div>
    </div>
  </footer>

  <!-- Full Screen Player Overlay -->
  <div class="full-player" [class.open]="isPlayerOpen()">
    <button class="btn-close-player" (click)="isPlayerOpen.set(false)">
      <svg class="icon-close" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>

    <div class="fp-content">
      <!-- Left Column: Cover & Info -->
      <div class="fp-left">
        <div class="fp-cover-wrapper">
          <img [src]="currentSong().coverUrl" class="fp-cover">
        </div>
        <div class="fp-info">
          <h2 class="fp-title">{{ currentSong().title }}</h2>
          <p class="fp-artist">{{ currentSong().artist }}</p>
          <p class="fp-album">{{ currentSong().album }}</p>
        </div>
      </div>

      <!-- Right Column: Visualizer & Controls -->
      <div class="fp-right">
        <!-- Sound Visualizer (Moved here) -->
        <div class="visualizer" *ngIf="isPlaying()">
          <div class="bar" *ngFor="let bar of visualizerBars"></div>
        </div>

        <!-- Full Player Controls -->
        <div class="fp-controls">
          <div class="scrubber full-width">
            <span class="time-current">{{ formattedCurrentTime() }}</span>
            <div class="scrubber-track" (click)="seek($event)">
              <div class="scrubber-fill" [style.width.%]="songProgressPercent()"></div>
              <div class="scrubber-thumb" [style.left.%]="songProgressPercent()"></div>
            </div>
            <span class="time-total">{{ currentSong().duration }}</span>
          </div>

          <div class="fp-buttons">
            <button class="btn-control-large" (click)="previous()">
              <svg class="icon-control-large" viewBox="0 0 24 24">
                <path d="M6 6h2v12H6zm3.5 6l8.5 6V6z" />
              </svg>
            </button>
            <button class="btn-play-pause-large" (click)="togglePlay()">
              <svg *ngIf="!isPlaying()" class="icon-play-large" viewBox="0 0 24 24">
                <path d="M8 5v14l11-7z" />
              </svg>
              <svg *ngIf="isPlaying()" class="icon-play-large" viewBox="0 0 24 24">
                <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z" />
              </svg>
            </button>
            <button class="btn-control-large" (click)="next()">
              <svg class="icon-control-large" viewBox="0 0 24 24">
                <path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z" />
              </svg>
            </button>
          </div>

          <!-- Full Player Volume -->
          <div class="volume-slider full-width-volume" style="width: 100%; max-width: 20rem; margin: 0 auto;">
            <svg class="icon-volume-small" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
            </svg>
            <div class="volume-track" (click)="setVolumeOnClick($event)">
              <div class="volume-fill" [style.width.%]="volume() * 100"></div>
              <div class="volume-thumb" [style.left.%]="volume() * 100"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Reward Toast -->
  <div class="reward-toast" *ngIf="showReward()">
    <div class="reward-content">
      <span class="reward-icon">ðŸ”¥</span>
      <div class="reward-text">
        <span class="reward-title">Streak Increased!</span>
        <span class="reward-subtitle">Keep listening to earn more!</span>
      </div>
    </div>
  </div>
</div>